  <!DOCTYPE html>
  <html dir="rtl" lang="ar">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>مسابقة رمضان</title>
      <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
      <style>
          body {
              font-family: 'Arial', sans-serif;
              margin: 0;
              padding: 20px;
              background-color: #f0f0f0;
              text-align: center;
          }
          .container {
              max-width: 600px;
              margin: 0 auto;
              background-color: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 0 10px rgba(0,0,0,0.1);
          }
          .hidden {
              display: none;
          }
          button {
              background-color: #4CAF50;
              color: white;
              padding: 10px 20px;
              border: none;
              border-radius: 5px;
              cursor: pointer;
              margin: 10px;
              font-size: 16px;
          }
          button:hover {
              background-color: #45a049;
          }
          input {
              padding: 10px;
              margin: 10px;
              width: 200px;
              font-size: 16px;
              border: 1px solid #ddd;
              border-radius: 5px;
          }
          .question {
              font-size: 1.2em;
              margin: 20px 0;
              font-weight: bold;
          }
          .options {
              display: flex;
              flex-direction: column;
              gap: 10px;
              align-items: center;
          }
          #timer {
              font-size: 1.2em;
              margin: 10px 0;
              color: #666;
          }
      </style>
  </head>
  <body>
      <div class="container">
          <div id="start-screen">
              <h1>مسابقة رمضان</h1>
              <input type="text" id="player-name" placeholder="أدخل اسمك">
              <button onclick="startGame()">ابدأ المسابقة</button>
          </div>

          <div id="quiz-screen" class="hidden">
              <div id="timer">الوقت: <span id="time">0</span></div>
              <div id="question" class="question"></div>
              <div id="options" class="options"></div>
          </div>

          <div id="results-screen" class="hidden">
              <h2>النتيجة النهائية</h2>
              <div id="final-score"></div>
              <a href="leaderboard.html"><button>عرض المتصدرين</button></a>
          </div>
      </div>

      <script>
          const firebaseConfig = {
              apiKey: "AIzaSyC5RYK1lGaJaMQJmOH85cqNgv6m7rbLS_A",
              authDomain: "ramadanmotaz-5570f.firebaseapp.com",
              projectId: "ramadanmotaz-5570f",
              storageBucket: "ramadanmotaz-5570f.firebasestorage.app",
              messagingSenderId: "595667154066",
              appId: "1:595667154066:web:80ba616566ec55a5efe24b",
              measurementId: "G-WLVRQVRGHT"
          };

          firebase.initializeApp(firebaseConfig);
          const db = firebase.firestore();

          const elements = {
              startScreen: document.getElementById('start-screen'),
              quizScreen: document.getElementById('quiz-screen'),
              resultsScreen: document.getElementById('results-screen'),
              playerNameInput: document.getElementById('player-name'),
              questionElement: document.getElementById('question'),
              optionsElement: document.getElementById('options'),
              timeElement: document.getElementById('time')
          };

          const gameState = {
              playerName: '',
              currentQuestion: 0,
              score: 0,
              startTime: 0,
              totalTime: 0,
              questionTimes: []
          };

          const questions = [
              {
                  question: "كم عدد ركعات صلاة التراويح؟",
                  options: ["8 ركعات", "20 ركعة", "12 ركعة", "16 ركعة"],
                  correct: 1
              },
              {
                  question: "في أي ليلة من رمضان تُتحرى ليلة القدر؟",
                  options: ["ليلة 27", "ليلة 29", "ليلة 21", "ليلة 23"],
                  correct: 0
              },
              {
                  question: "ما هو أول مسجد بُني في الإسلام؟",
                  options: ["المسجد الحرام", "المسجد النبوي", "مسجد قباء", "المسجد الأقصى"],
                  correct: 2
              }
          ];

          function startGame() {
              if (!elements.playerNameInput.value.trim()) {
                  alert('الرجاء إدخال اسمك');
                  return;
              }

              gameState.playerName = elements.playerNameInput.value.trim();
              gameState.startTime = Date.now();
              elements.startScreen.classList.add('hidden');
              elements.quizScreen.classList.remove('hidden');
              showQuestion();
              startTimer();
          }

          function showQuestion() {
              if (gameState.currentQuestion >= questions.length) {
                  showResults();
                  return;
              }

              const question = questions[gameState.currentQuestion];
              elements.questionElement.textContent = question.question;
              elements.optionsElement.innerHTML = '';

              question.options.forEach((option, index) => {
                  const button = document.createElement('button');
                  button.textContent = option;
                  button.onclick = () => checkAnswer(index);
                  elements.optionsElement.appendChild(button);
              });
          }

          function checkAnswer(selectedIndex) {
              const question = questions[gameState.currentQuestion];
              const timeTaken = (Date.now() - gameState.startTime) / 1000;
              gameState.questionTimes.push(timeTaken);

              if (selectedIndex === question.correct) {
                  gameState.score += 1;
              }

              gameState.currentQuestion += 1;
              showQuestion();
          }

          function showResults() {
              gameState.totalTime = (Date.now() - gameState.startTime) / 1000;
              elements.quizScreen.classList.add('hidden');
              elements.resultsScreen.classList.remove('hidden');

              const result = {
                  playerName: gameState.playerName,
                  score: gameState.score,
                  totalTime: gameState.totalTime,
                  questionTimes: gameState.questionTimes,
                  timestamp: firebase.firestore.FieldValue.serverTimestamp()
              };

              db.collection('scores').add(result)
                  .then(() => {
                      console.log('تم حفظ النتيجة بنجاح');
                  })
                  .catch((error) => {
                      console.error('خطأ في حفظ النتيجة:', error);
                  });

              document.getElementById('final-score').innerHTML = `
                  الاسم: ${gameState.playerName}<br>
                  النقاط: ${gameState.score} من ${questions.length}<br>
                  الوقت المستغرق: ${gameState.totalTime.toFixed(2)} ثانية
              `;
          }

          function startTimer() {
              setInterval(() => {
                  const currentTime = (Date.now() - gameState.startTime) / 1000;
                  elements.timeElement.textContent = currentTime.toFixed(1);
              }, 100);
          }
      </script>
  </body>
  </html>
